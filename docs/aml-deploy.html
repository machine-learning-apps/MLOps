<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link type="text/css" href="/css/pages.css" media="all" rel="stylesheet">

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Aml Deploy | Machine Learning Ops</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Aml Deploy" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Usage The Azure Machine Learning Deploy action will deploy your model on Azure Machine Learning and create a real-time endpoint for use in other systems. The action currently supports Azure Container Instance and Azure Kubernetes Service as compute target and also supports the no-code deployment of Azure Machine Learning, if the model has been regiustered accordingly. This GitHub Action also allows you to provide a python script that executes tests against the Webservice endpoint after the model deplyoment has completed successfully. You can enable tests by setting the parameter test_enabled to true. In addition to that, you have to provide a python script (default code/test/test.py) which includes a function (default ` def main(webservice):`) that describes your tests that you want to execute against the service object. The python script gets the webservice object injected. The action fails, if the test script fails. This action requires an Azure Machine Learning workspace to be created or attached to via the aml-workspace action and an AKS cluster if you are planning to deploy your model to such a compute target. AKS clsuters can be managed via the aml-compute action. Template repositories This action is one in a series of actions that can be used to setup an ML Ops process. Examples of these can be found at Simple example: ml-template-azure and Comprehensive example: aml-template. Example workflow name: My Workflow on: [push, pull_request] jobs: build: runs-on: ubuntu-latest steps: # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it - name: Check Out Repository id: checkout_repository uses: actions/checkout@v2 # AML Workspace Action - uses: Azure/aml-workspace id: aml_workspace with: azure_credentials: $ # AML Register Model Action - uses: Azure/aml-registermodel id: aml_registermodel with: azure_credentials: $ run_id: &quot;&lt;your-run-id&gt;&quot; experiment_name: &quot;&lt;your-experiment-name&gt;&quot; # Deploy model in Azure Machine Learning to ACI - name: Deploy model id: aml_deploy uses: Azure/aml-deploy@master with: # required inputs azure_credentials: $ model_name: $ model_version: $ # optional inputs parameters_file: &quot;deploy.json&quot; Inputs Input Required Default Description azure_credentials x - Output of az ad sp create-for-rbac --name &lt;your-sp-name&gt; --role contributor --scopes /subscriptions/&lt;your-subscriptionId&gt;/resourceGroups/&lt;your-rg&gt; --sdk-auth. This should be stored in your secrets model_name x - Name of the model that will be deployed. model_version x - Version of the model that will be deployed. parameters_file   &quot;registermodel.json&quot; JSON file in the .cloud/.azure folder specifying your Azure Machine Learning model registration details. Azure Credentials Azure credentials are required to connect to your Azure Machine Learning Workspace. These may have been created for an action you are already using in your repository, if so, you can skip the steps below. Install the Azure CLI on your computer or use the Cloud CLI and execute the following command to generate the required credentials: # Replace {service-principal-name}, {subscription-id} and {resource-group} with your Azure subscription id and resource group name and any name for your service principle az ad sp create-for-rbac --name {service-principal-name} \ --role contributor \ --scopes /subscriptions/{subscription-id}/resourceGroups/{resource-group} \ --sdk-auth This will generate the following JSON output: { &quot;clientId&quot;: &quot;&lt;GUID&gt;&quot;, &quot;clientSecret&quot;: &quot;&lt;GUID&gt;&quot;, &quot;subscriptionId&quot;: &quot;&lt;GUID&gt;&quot;, &quot;tenantId&quot;: &quot;&lt;GUID&gt;&quot;, (...) } Add this JSON output as a secret with the name AZURE_CREDENTIALS in your GitHub repository. Parameters File The action tries to load a JSON file in the .cloud/.azure folder in your repository, which specifies details for the model deployment to your Azure Machine Learning Workspace. By default, the action expects a file with the name deploy.json. If your JSON file has a different name, you can specify it with this parameter. Note that none of these values are required and in the absence, defaults will be created with a combination of the repo name and branch name. A sample file can be found in this repository in the folder .cloud/.azure. There are separate parameters that are used for the ACI deployment, the AKS deployment and some that are common for both deployment options. Common parameters Parameter Required Allowed Values Default Description name   str - The name to give the deployed service. Must be unique to the workspace, only consist of lowercase letters, numbers, or dashes, start with a letter, and be between 3 and 32 characters long. deployment_compute_target (for AKS deployment) str null Name of the compute target to deploy the webservice to. As Azure Container Instances has no associated ComputeTarget, leave this parameter as null to deploy to Azure Container Instances. inference_source_directory   str &quot;code/deploy/&quot; The path to the folder that contains all files to create the image. inference_entry_script   str &quot;score.py&quot; The path to a local file in your repository that contains the code to run for the image and score the data. This path is relative to the specified source directory. The python script has to define an init and a run function. A sample can be found in the template repositories. conda_file   str &quot;environment.yml&quot; The path to a local file in your repository containing a conda environment definition to use for the image. This path is relative to the specified source directory. extra_docker_file_steps   str null The path to a local file in your repository containing additional Docker steps to run when setting up image. This path is relative to the specified source directory. enable_gpu   str false Indicates whether to enable GPU support in the image. The GPU image must be used on Microsoft Azure Services such as Azure Container Instances, Azure Machine Learning Compute, Azure Virtual Machines, and Azure Kubernetes Service. cuda_version   str &quot;9.1&quot; if enable_gpu is set to true The Version of CUDA to install for images that need GPU support. The GPU image must be used on Microsoft Azure Services such as Azure Container Instances, Azure Machine Learning Compute, Azure Virtual Machines, and Azure Kubernetes Service. Supported versions are 9.0, 9.1, and 10.0. runtime   str: &quot;python&quot; or &quot;spark-py&quot; &quot;python&quot; The runtime to use for the image. custom_base_image   str null A custom Docker image to be used as base image. If no base image is given then the base image will be used based off of given runtime parameter. model_data_collection_enabled   bool false Whether or not to enable model data collection for this Webservice. authentication_enabled   bool false for ACI, true for AKS Whether or not to enable key auth for this Webservice. app_insights_enabled   bool false Whether or not to enable Application Insights logging for this Webservice. cpu_cores   float 0.1 The number of CPU cores to allocate for this Webservice. Can be a decimal. memory_gb   float 0.5 The amount of memory (in GB) to allocate for this Webservice. Can be a decimal. delete_service_after_deployment   bool false Indicates whether the service gets deleted after the deployment completed successfully. tags   dict: {“&quot;: &quot;&quot;, ...} null Dictionary of key value tags to give this Webservice. properties   dict: {“&quot;: &quot;&quot;, ...}   Dictionary of key value properties to give this Webservice. These properties cannot be changed after deployment, however new key value pairs can be added. description   str null A description to give this Webservice and image. test_enabled   bool false Whether to run tests for this model deployment and the created real-time endpoint. test_file_path   str &quot;code/test/test.py&quot; Path to the python script in your repository in which you define your own tests that you want to run against the webservice endpoint. The GitHub Action fails, if your script fails. test_file_function_name   str &quot;main&quot; Name of the function in your python script in your repository in which you define your own tests that you want to run against the webservice endpoint. The function gets the webservice object injected and allows you to run tests against the scoring uri. The GitHub Action fails, if your script fails. Please visit this website and this website for more details. ACI specific parameters ACI is the default deployment resource. A sample file for an aci deployment can be found in the .cloud/.azure folder. Parameter Required Allowed Values Default Description location   str: supported region workspace location The Azure region to deploy this Webservice to. ssl_enabled   bool false Whether or not to enable SSL for this Webservice. ssl_cert_pem_file   str null A file path to a file containing cert information for SSL validation. Must provide all three CName, cert file, and key file to enable SSL validation. ssl_key_pem_file   st null A file path to a file containing key information for SSL validation. Must provide all three CName, cert file, and key file to enable SSL validation. ssl_cname   str null A CName to use if enabling SSL validation on the cluster. Must provide all three CName, cert file, and key file to enable SSL validation. dns_name_label   str null The DNS name label for the scoring endpoint. If not specified a unique DNS name label will be generated for the scoring endpoint. Please visit this website for more details. AKS Deployment For the deployment of the model to AKS, you must configure an AKS resource and specify the name of the AKS cluster with the deployment_compute_target parameter. Additional parameters allow you to finetune your deployment on AKS with options like autoscaling and the liveness probe requirements. These will be set to default parameters if not provided. Parameter Required Allowed Values Default Description gpu_cores   float 1 The number of GPU cores to allocate for this Webservice. autoscale_enabled   bool true if num_replicas is null Whether or not to enable autoscaling for this Webservice. autoscale_min_replicas   int 1 The minimum number of containers to use when autoscaling this Webservice. autoscale_max_replicas   int 10 The maximum number of containers to use when autoscaling this Webservice. autoscale_refresh_seconds   int 1 How often the autoscaler should attempt to scale this Webservice. autoscale_target_utilization   int 70 The target utilization (in percent out of 100) the autoscaler should attempt to maintain for this Webservice. scoring_timeout_ms   int 60000 A timeout in ms to enforce for scoring calls to this Webservice. replica_max_concurrent_requests   float 1 The number of maximum concurrent requests per replica to allow for this Webservice. Do not change this setting from the default value of 1 unless instructed by Microsoft Technical Support or a member of Azure Machine Learning team. max_request_wait_time   int 500 The maximum amount of time a request will stay in the queue (in milliseconds) before returning a 503 error. num_replicas   int null The number of containers to allocate for this Webservice. No default, if this parameter is not set then the autoscaler is enabled by default. period_seconds   int: [1, inf[ 10 How often (in seconds) to perform the liveness probe. initial_delay_seconds   int 310 The number of seconds after the container has started before liveness probes are initiated. timeout_seconds   int: [1, inf[ 1 The number of seconds after which the liveness probe times out. success_threshold   int: [1, inf[ 1 The minimum consecutive successes for the liveness probe to be considered successful after having failed. failure_threshold   int: [1, inf[ 3 When a Pod starts and the liveness probe fails, Kubernetes will try failureThreshold times before giving up. namespace   str null The Kubernetes namespace in which to deploy this Webservice: up to 63 lowercase alphanumeric (‘a’-‘z’, ‘0’-‘9’) and hyphen (‘-‘) characters. The first and last characters cannot be hyphens. token_auth_enabled   bool false Whether or not to enable Token auth for this Webservice. If this is enabled, users can access this Webservice by fetching an access token using their Azure Active Directory credentials. Please visit this website for more details. More Information on autoscaling parameters can be found here and for liveness probe here. Outputs Output Description service_scoring_uri Scoring URI of the webservice that was created (only provided if delete_service_after_test is set to False). service_swagger_uri Swagger Uri of the webservice that was created (only provided if delete_service_after_test is set to False). Environment variables Certain parameters are considered secrets and should therefore be passed as environment variables from your secrets, if you want to use custom values. Environment variable Required Allowed Values Default Description CONTAINER_REGISTRY_ADRESS   str null The DNS name or IP address of the Azure Container Registry (ACR). Required, if you specified a custom_base_image that is only available in your ACR. CONTAINER_REGISTRY_USERNAME   str null The username for ACR. Required, if you specified a custom_base_image that is only available in your ACR. CONTAINER_REGISTRY_PASSWORD   str null The password for ACR. Required, if you specified a custom_base_image that is only available in your ACR. PRIMARY_KEY   str null A primary auth key to use for this Webservice. If not specified, Azure will automatically assign a key. SECONDARY_KEY   str null A secondary auth key to use for this Webservice. If not specified, Azure will automatically assign a key. CMK_VAULT_BASE_URL   str null Customer managed Key Vault base url. This value is ACI specific. CMK_KEY_NAME   str null Customer managed key name. This value is ACI specific. CMK_KEY_VERSION   str null Customer managed key version. This value is ACI specific. Other Azure Machine Learning Actions aml-workspace - Connects to or creates a new workspace aml-compute - Connects to or creates a new compute target in Azure Machine Learning aml-run - Submits a ScriptRun, an Estimator or a Pipeline to Azure Machine Learning aml-registermodel - Registers a model to Azure Machine Learning aml-deploy - Deploys a model and creates an endpoint for the model Contributing This project welcomes contributions and suggestions. Most contributions require you to agree to a Contributor License Agreement (CLA) declaring that you have the right to, and actually do, grant us the rights to use your contribution. For details, visit https://cla.opensource.microsoft.com. When you submit a pull request, a CLA bot will automatically determine whether you need to provide a CLA and decorate the PR appropriately (e.g., status check, comment). Simply follow the instructions provided by the bot. You will only need to do this once across all repos using our CLA. This project has adopted the Microsoft Open Source Code of Conduct. For more information see the Code of Conduct FAQ or contact opencode@microsoft.com with any additional questions or comments." />
<meta property="og:description" content="Usage The Azure Machine Learning Deploy action will deploy your model on Azure Machine Learning and create a real-time endpoint for use in other systems. The action currently supports Azure Container Instance and Azure Kubernetes Service as compute target and also supports the no-code deployment of Azure Machine Learning, if the model has been regiustered accordingly. This GitHub Action also allows you to provide a python script that executes tests against the Webservice endpoint after the model deplyoment has completed successfully. You can enable tests by setting the parameter test_enabled to true. In addition to that, you have to provide a python script (default code/test/test.py) which includes a function (default ` def main(webservice):`) that describes your tests that you want to execute against the service object. The python script gets the webservice object injected. The action fails, if the test script fails. This action requires an Azure Machine Learning workspace to be created or attached to via the aml-workspace action and an AKS cluster if you are planning to deploy your model to such a compute target. AKS clsuters can be managed via the aml-compute action. Template repositories This action is one in a series of actions that can be used to setup an ML Ops process. Examples of these can be found at Simple example: ml-template-azure and Comprehensive example: aml-template. Example workflow name: My Workflow on: [push, pull_request] jobs: build: runs-on: ubuntu-latest steps: # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it - name: Check Out Repository id: checkout_repository uses: actions/checkout@v2 # AML Workspace Action - uses: Azure/aml-workspace id: aml_workspace with: azure_credentials: $ # AML Register Model Action - uses: Azure/aml-registermodel id: aml_registermodel with: azure_credentials: $ run_id: &quot;&lt;your-run-id&gt;&quot; experiment_name: &quot;&lt;your-experiment-name&gt;&quot; # Deploy model in Azure Machine Learning to ACI - name: Deploy model id: aml_deploy uses: Azure/aml-deploy@master with: # required inputs azure_credentials: $ model_name: $ model_version: $ # optional inputs parameters_file: &quot;deploy.json&quot; Inputs Input Required Default Description azure_credentials x - Output of az ad sp create-for-rbac --name &lt;your-sp-name&gt; --role contributor --scopes /subscriptions/&lt;your-subscriptionId&gt;/resourceGroups/&lt;your-rg&gt; --sdk-auth. This should be stored in your secrets model_name x - Name of the model that will be deployed. model_version x - Version of the model that will be deployed. parameters_file   &quot;registermodel.json&quot; JSON file in the .cloud/.azure folder specifying your Azure Machine Learning model registration details. Azure Credentials Azure credentials are required to connect to your Azure Machine Learning Workspace. These may have been created for an action you are already using in your repository, if so, you can skip the steps below. Install the Azure CLI on your computer or use the Cloud CLI and execute the following command to generate the required credentials: # Replace {service-principal-name}, {subscription-id} and {resource-group} with your Azure subscription id and resource group name and any name for your service principle az ad sp create-for-rbac --name {service-principal-name} \ --role contributor \ --scopes /subscriptions/{subscription-id}/resourceGroups/{resource-group} \ --sdk-auth This will generate the following JSON output: { &quot;clientId&quot;: &quot;&lt;GUID&gt;&quot;, &quot;clientSecret&quot;: &quot;&lt;GUID&gt;&quot;, &quot;subscriptionId&quot;: &quot;&lt;GUID&gt;&quot;, &quot;tenantId&quot;: &quot;&lt;GUID&gt;&quot;, (...) } Add this JSON output as a secret with the name AZURE_CREDENTIALS in your GitHub repository. Parameters File The action tries to load a JSON file in the .cloud/.azure folder in your repository, which specifies details for the model deployment to your Azure Machine Learning Workspace. By default, the action expects a file with the name deploy.json. If your JSON file has a different name, you can specify it with this parameter. Note that none of these values are required and in the absence, defaults will be created with a combination of the repo name and branch name. A sample file can be found in this repository in the folder .cloud/.azure. There are separate parameters that are used for the ACI deployment, the AKS deployment and some that are common for both deployment options. Common parameters Parameter Required Allowed Values Default Description name   str - The name to give the deployed service. Must be unique to the workspace, only consist of lowercase letters, numbers, or dashes, start with a letter, and be between 3 and 32 characters long. deployment_compute_target (for AKS deployment) str null Name of the compute target to deploy the webservice to. As Azure Container Instances has no associated ComputeTarget, leave this parameter as null to deploy to Azure Container Instances. inference_source_directory   str &quot;code/deploy/&quot; The path to the folder that contains all files to create the image. inference_entry_script   str &quot;score.py&quot; The path to a local file in your repository that contains the code to run for the image and score the data. This path is relative to the specified source directory. The python script has to define an init and a run function. A sample can be found in the template repositories. conda_file   str &quot;environment.yml&quot; The path to a local file in your repository containing a conda environment definition to use for the image. This path is relative to the specified source directory. extra_docker_file_steps   str null The path to a local file in your repository containing additional Docker steps to run when setting up image. This path is relative to the specified source directory. enable_gpu   str false Indicates whether to enable GPU support in the image. The GPU image must be used on Microsoft Azure Services such as Azure Container Instances, Azure Machine Learning Compute, Azure Virtual Machines, and Azure Kubernetes Service. cuda_version   str &quot;9.1&quot; if enable_gpu is set to true The Version of CUDA to install for images that need GPU support. The GPU image must be used on Microsoft Azure Services such as Azure Container Instances, Azure Machine Learning Compute, Azure Virtual Machines, and Azure Kubernetes Service. Supported versions are 9.0, 9.1, and 10.0. runtime   str: &quot;python&quot; or &quot;spark-py&quot; &quot;python&quot; The runtime to use for the image. custom_base_image   str null A custom Docker image to be used as base image. If no base image is given then the base image will be used based off of given runtime parameter. model_data_collection_enabled   bool false Whether or not to enable model data collection for this Webservice. authentication_enabled   bool false for ACI, true for AKS Whether or not to enable key auth for this Webservice. app_insights_enabled   bool false Whether or not to enable Application Insights logging for this Webservice. cpu_cores   float 0.1 The number of CPU cores to allocate for this Webservice. Can be a decimal. memory_gb   float 0.5 The amount of memory (in GB) to allocate for this Webservice. Can be a decimal. delete_service_after_deployment   bool false Indicates whether the service gets deleted after the deployment completed successfully. tags   dict: {“&quot;: &quot;&quot;, ...} null Dictionary of key value tags to give this Webservice. properties   dict: {“&quot;: &quot;&quot;, ...}   Dictionary of key value properties to give this Webservice. These properties cannot be changed after deployment, however new key value pairs can be added. description   str null A description to give this Webservice and image. test_enabled   bool false Whether to run tests for this model deployment and the created real-time endpoint. test_file_path   str &quot;code/test/test.py&quot; Path to the python script in your repository in which you define your own tests that you want to run against the webservice endpoint. The GitHub Action fails, if your script fails. test_file_function_name   str &quot;main&quot; Name of the function in your python script in your repository in which you define your own tests that you want to run against the webservice endpoint. The function gets the webservice object injected and allows you to run tests against the scoring uri. The GitHub Action fails, if your script fails. Please visit this website and this website for more details. ACI specific parameters ACI is the default deployment resource. A sample file for an aci deployment can be found in the .cloud/.azure folder. Parameter Required Allowed Values Default Description location   str: supported region workspace location The Azure region to deploy this Webservice to. ssl_enabled   bool false Whether or not to enable SSL for this Webservice. ssl_cert_pem_file   str null A file path to a file containing cert information for SSL validation. Must provide all three CName, cert file, and key file to enable SSL validation. ssl_key_pem_file   st null A file path to a file containing key information for SSL validation. Must provide all three CName, cert file, and key file to enable SSL validation. ssl_cname   str null A CName to use if enabling SSL validation on the cluster. Must provide all three CName, cert file, and key file to enable SSL validation. dns_name_label   str null The DNS name label for the scoring endpoint. If not specified a unique DNS name label will be generated for the scoring endpoint. Please visit this website for more details. AKS Deployment For the deployment of the model to AKS, you must configure an AKS resource and specify the name of the AKS cluster with the deployment_compute_target parameter. Additional parameters allow you to finetune your deployment on AKS with options like autoscaling and the liveness probe requirements. These will be set to default parameters if not provided. Parameter Required Allowed Values Default Description gpu_cores   float 1 The number of GPU cores to allocate for this Webservice. autoscale_enabled   bool true if num_replicas is null Whether or not to enable autoscaling for this Webservice. autoscale_min_replicas   int 1 The minimum number of containers to use when autoscaling this Webservice. autoscale_max_replicas   int 10 The maximum number of containers to use when autoscaling this Webservice. autoscale_refresh_seconds   int 1 How often the autoscaler should attempt to scale this Webservice. autoscale_target_utilization   int 70 The target utilization (in percent out of 100) the autoscaler should attempt to maintain for this Webservice. scoring_timeout_ms   int 60000 A timeout in ms to enforce for scoring calls to this Webservice. replica_max_concurrent_requests   float 1 The number of maximum concurrent requests per replica to allow for this Webservice. Do not change this setting from the default value of 1 unless instructed by Microsoft Technical Support or a member of Azure Machine Learning team. max_request_wait_time   int 500 The maximum amount of time a request will stay in the queue (in milliseconds) before returning a 503 error. num_replicas   int null The number of containers to allocate for this Webservice. No default, if this parameter is not set then the autoscaler is enabled by default. period_seconds   int: [1, inf[ 10 How often (in seconds) to perform the liveness probe. initial_delay_seconds   int 310 The number of seconds after the container has started before liveness probes are initiated. timeout_seconds   int: [1, inf[ 1 The number of seconds after which the liveness probe times out. success_threshold   int: [1, inf[ 1 The minimum consecutive successes for the liveness probe to be considered successful after having failed. failure_threshold   int: [1, inf[ 3 When a Pod starts and the liveness probe fails, Kubernetes will try failureThreshold times before giving up. namespace   str null The Kubernetes namespace in which to deploy this Webservice: up to 63 lowercase alphanumeric (‘a’-‘z’, ‘0’-‘9’) and hyphen (‘-‘) characters. The first and last characters cannot be hyphens. token_auth_enabled   bool false Whether or not to enable Token auth for this Webservice. If this is enabled, users can access this Webservice by fetching an access token using their Azure Active Directory credentials. Please visit this website for more details. More Information on autoscaling parameters can be found here and for liveness probe here. Outputs Output Description service_scoring_uri Scoring URI of the webservice that was created (only provided if delete_service_after_test is set to False). service_swagger_uri Swagger Uri of the webservice that was created (only provided if delete_service_after_test is set to False). Environment variables Certain parameters are considered secrets and should therefore be passed as environment variables from your secrets, if you want to use custom values. Environment variable Required Allowed Values Default Description CONTAINER_REGISTRY_ADRESS   str null The DNS name or IP address of the Azure Container Registry (ACR). Required, if you specified a custom_base_image that is only available in your ACR. CONTAINER_REGISTRY_USERNAME   str null The username for ACR. Required, if you specified a custom_base_image that is only available in your ACR. CONTAINER_REGISTRY_PASSWORD   str null The password for ACR. Required, if you specified a custom_base_image that is only available in your ACR. PRIMARY_KEY   str null A primary auth key to use for this Webservice. If not specified, Azure will automatically assign a key. SECONDARY_KEY   str null A secondary auth key to use for this Webservice. If not specified, Azure will automatically assign a key. CMK_VAULT_BASE_URL   str null Customer managed Key Vault base url. This value is ACI specific. CMK_KEY_NAME   str null Customer managed key name. This value is ACI specific. CMK_KEY_VERSION   str null Customer managed key version. This value is ACI specific. Other Azure Machine Learning Actions aml-workspace - Connects to or creates a new workspace aml-compute - Connects to or creates a new compute target in Azure Machine Learning aml-run - Submits a ScriptRun, an Estimator or a Pipeline to Azure Machine Learning aml-registermodel - Registers a model to Azure Machine Learning aml-deploy - Deploys a model and creates an endpoint for the model Contributing This project welcomes contributions and suggestions. Most contributions require you to agree to a Contributor License Agreement (CLA) declaring that you have the right to, and actually do, grant us the rights to use your contribution. For details, visit https://cla.opensource.microsoft.com. When you submit a pull request, a CLA bot will automatically determine whether you need to provide a CLA and decorate the PR appropriately (e.g., status check, comment). Simply follow the instructions provided by the bot. You will only need to do this once across all repos using our CLA. This project has adopted the Microsoft Open Source Code of Conduct. For more information see the Code of Conduct FAQ or contact opencode@microsoft.com with any additional questions or comments." />
<link rel="canonical" href="https://machine-learning-apps.github.io/MLDevOps/docs/aml-deploy.html" />
<meta property="og:url" content="https://machine-learning-apps.github.io/MLDevOps/docs/aml-deploy.html" />
<meta property="og:site_name" content="Machine Learning Ops" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-04-19T08:28:26-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Aml Deploy" />
<meta name="twitter:site" content="@github" />
<script type="application/ld+json">
{"dateModified":"2020-04-19T08:28:26-05:00","datePublished":"2020-04-19T08:28:26-05:00","description":"Usage The Azure Machine Learning Deploy action will deploy your model on Azure Machine Learning and create a real-time endpoint for use in other systems. The action currently supports Azure Container Instance and Azure Kubernetes Service as compute target and also supports the no-code deployment of Azure Machine Learning, if the model has been regiustered accordingly. This GitHub Action also allows you to provide a python script that executes tests against the Webservice endpoint after the model deplyoment has completed successfully. You can enable tests by setting the parameter test_enabled to true. In addition to that, you have to provide a python script (default code/test/test.py) which includes a function (default ` def main(webservice):`) that describes your tests that you want to execute against the service object. The python script gets the webservice object injected. The action fails, if the test script fails. This action requires an Azure Machine Learning workspace to be created or attached to via the aml-workspace action and an AKS cluster if you are planning to deploy your model to such a compute target. AKS clsuters can be managed via the aml-compute action. Template repositories This action is one in a series of actions that can be used to setup an ML Ops process. Examples of these can be found at Simple example: ml-template-azure and Comprehensive example: aml-template. Example workflow name: My Workflow on: [push, pull_request] jobs: build: runs-on: ubuntu-latest steps: # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it - name: Check Out Repository id: checkout_repository uses: actions/checkout@v2 # AML Workspace Action - uses: Azure/aml-workspace id: aml_workspace with: azure_credentials: $ # AML Register Model Action - uses: Azure/aml-registermodel id: aml_registermodel with: azure_credentials: $ run_id: &quot;&lt;your-run-id&gt;&quot; experiment_name: &quot;&lt;your-experiment-name&gt;&quot; # Deploy model in Azure Machine Learning to ACI - name: Deploy model id: aml_deploy uses: Azure/aml-deploy@master with: # required inputs azure_credentials: $ model_name: $ model_version: $ # optional inputs parameters_file: &quot;deploy.json&quot; Inputs Input Required Default Description azure_credentials x - Output of az ad sp create-for-rbac --name &lt;your-sp-name&gt; --role contributor --scopes /subscriptions/&lt;your-subscriptionId&gt;/resourceGroups/&lt;your-rg&gt; --sdk-auth. This should be stored in your secrets model_name x - Name of the model that will be deployed. model_version x - Version of the model that will be deployed. parameters_file   &quot;registermodel.json&quot; JSON file in the .cloud/.azure folder specifying your Azure Machine Learning model registration details. Azure Credentials Azure credentials are required to connect to your Azure Machine Learning Workspace. These may have been created for an action you are already using in your repository, if so, you can skip the steps below. Install the Azure CLI on your computer or use the Cloud CLI and execute the following command to generate the required credentials: # Replace {service-principal-name}, {subscription-id} and {resource-group} with your Azure subscription id and resource group name and any name for your service principle az ad sp create-for-rbac --name {service-principal-name} \\ --role contributor \\ --scopes /subscriptions/{subscription-id}/resourceGroups/{resource-group} \\ --sdk-auth This will generate the following JSON output: { &quot;clientId&quot;: &quot;&lt;GUID&gt;&quot;, &quot;clientSecret&quot;: &quot;&lt;GUID&gt;&quot;, &quot;subscriptionId&quot;: &quot;&lt;GUID&gt;&quot;, &quot;tenantId&quot;: &quot;&lt;GUID&gt;&quot;, (...) } Add this JSON output as a secret with the name AZURE_CREDENTIALS in your GitHub repository. Parameters File The action tries to load a JSON file in the .cloud/.azure folder in your repository, which specifies details for the model deployment to your Azure Machine Learning Workspace. By default, the action expects a file with the name deploy.json. If your JSON file has a different name, you can specify it with this parameter. Note that none of these values are required and in the absence, defaults will be created with a combination of the repo name and branch name. A sample file can be found in this repository in the folder .cloud/.azure. There are separate parameters that are used for the ACI deployment, the AKS deployment and some that are common for both deployment options. Common parameters Parameter Required Allowed Values Default Description name   str - The name to give the deployed service. Must be unique to the workspace, only consist of lowercase letters, numbers, or dashes, start with a letter, and be between 3 and 32 characters long. deployment_compute_target (for AKS deployment) str null Name of the compute target to deploy the webservice to. As Azure Container Instances has no associated ComputeTarget, leave this parameter as null to deploy to Azure Container Instances. inference_source_directory   str &quot;code/deploy/&quot; The path to the folder that contains all files to create the image. inference_entry_script   str &quot;score.py&quot; The path to a local file in your repository that contains the code to run for the image and score the data. This path is relative to the specified source directory. The python script has to define an init and a run function. A sample can be found in the template repositories. conda_file   str &quot;environment.yml&quot; The path to a local file in your repository containing a conda environment definition to use for the image. This path is relative to the specified source directory. extra_docker_file_steps   str null The path to a local file in your repository containing additional Docker steps to run when setting up image. This path is relative to the specified source directory. enable_gpu   str false Indicates whether to enable GPU support in the image. The GPU image must be used on Microsoft Azure Services such as Azure Container Instances, Azure Machine Learning Compute, Azure Virtual Machines, and Azure Kubernetes Service. cuda_version   str &quot;9.1&quot; if enable_gpu is set to true The Version of CUDA to install for images that need GPU support. The GPU image must be used on Microsoft Azure Services such as Azure Container Instances, Azure Machine Learning Compute, Azure Virtual Machines, and Azure Kubernetes Service. Supported versions are 9.0, 9.1, and 10.0. runtime   str: &quot;python&quot; or &quot;spark-py&quot; &quot;python&quot; The runtime to use for the image. custom_base_image   str null A custom Docker image to be used as base image. If no base image is given then the base image will be used based off of given runtime parameter. model_data_collection_enabled   bool false Whether or not to enable model data collection for this Webservice. authentication_enabled   bool false for ACI, true for AKS Whether or not to enable key auth for this Webservice. app_insights_enabled   bool false Whether or not to enable Application Insights logging for this Webservice. cpu_cores   float 0.1 The number of CPU cores to allocate for this Webservice. Can be a decimal. memory_gb   float 0.5 The amount of memory (in GB) to allocate for this Webservice. Can be a decimal. delete_service_after_deployment   bool false Indicates whether the service gets deleted after the deployment completed successfully. tags   dict: {“&quot;: &quot;&quot;, ...} null Dictionary of key value tags to give this Webservice. properties   dict: {“&quot;: &quot;&quot;, ...}   Dictionary of key value properties to give this Webservice. These properties cannot be changed after deployment, however new key value pairs can be added. description   str null A description to give this Webservice and image. test_enabled   bool false Whether to run tests for this model deployment and the created real-time endpoint. test_file_path   str &quot;code/test/test.py&quot; Path to the python script in your repository in which you define your own tests that you want to run against the webservice endpoint. The GitHub Action fails, if your script fails. test_file_function_name   str &quot;main&quot; Name of the function in your python script in your repository in which you define your own tests that you want to run against the webservice endpoint. The function gets the webservice object injected and allows you to run tests against the scoring uri. The GitHub Action fails, if your script fails. Please visit this website and this website for more details. ACI specific parameters ACI is the default deployment resource. A sample file for an aci deployment can be found in the .cloud/.azure folder. Parameter Required Allowed Values Default Description location   str: supported region workspace location The Azure region to deploy this Webservice to. ssl_enabled   bool false Whether or not to enable SSL for this Webservice. ssl_cert_pem_file   str null A file path to a file containing cert information for SSL validation. Must provide all three CName, cert file, and key file to enable SSL validation. ssl_key_pem_file   st null A file path to a file containing key information for SSL validation. Must provide all three CName, cert file, and key file to enable SSL validation. ssl_cname   str null A CName to use if enabling SSL validation on the cluster. Must provide all three CName, cert file, and key file to enable SSL validation. dns_name_label   str null The DNS name label for the scoring endpoint. If not specified a unique DNS name label will be generated for the scoring endpoint. Please visit this website for more details. AKS Deployment For the deployment of the model to AKS, you must configure an AKS resource and specify the name of the AKS cluster with the deployment_compute_target parameter. Additional parameters allow you to finetune your deployment on AKS with options like autoscaling and the liveness probe requirements. These will be set to default parameters if not provided. Parameter Required Allowed Values Default Description gpu_cores   float 1 The number of GPU cores to allocate for this Webservice. autoscale_enabled   bool true if num_replicas is null Whether or not to enable autoscaling for this Webservice. autoscale_min_replicas   int 1 The minimum number of containers to use when autoscaling this Webservice. autoscale_max_replicas   int 10 The maximum number of containers to use when autoscaling this Webservice. autoscale_refresh_seconds   int 1 How often the autoscaler should attempt to scale this Webservice. autoscale_target_utilization   int 70 The target utilization (in percent out of 100) the autoscaler should attempt to maintain for this Webservice. scoring_timeout_ms   int 60000 A timeout in ms to enforce for scoring calls to this Webservice. replica_max_concurrent_requests   float 1 The number of maximum concurrent requests per replica to allow for this Webservice. Do not change this setting from the default value of 1 unless instructed by Microsoft Technical Support or a member of Azure Machine Learning team. max_request_wait_time   int 500 The maximum amount of time a request will stay in the queue (in milliseconds) before returning a 503 error. num_replicas   int null The number of containers to allocate for this Webservice. No default, if this parameter is not set then the autoscaler is enabled by default. period_seconds   int: [1, inf[ 10 How often (in seconds) to perform the liveness probe. initial_delay_seconds   int 310 The number of seconds after the container has started before liveness probes are initiated. timeout_seconds   int: [1, inf[ 1 The number of seconds after which the liveness probe times out. success_threshold   int: [1, inf[ 1 The minimum consecutive successes for the liveness probe to be considered successful after having failed. failure_threshold   int: [1, inf[ 3 When a Pod starts and the liveness probe fails, Kubernetes will try failureThreshold times before giving up. namespace   str null The Kubernetes namespace in which to deploy this Webservice: up to 63 lowercase alphanumeric (‘a’-‘z’, ‘0’-‘9’) and hyphen (‘-‘) characters. The first and last characters cannot be hyphens. token_auth_enabled   bool false Whether or not to enable Token auth for this Webservice. If this is enabled, users can access this Webservice by fetching an access token using their Azure Active Directory credentials. Please visit this website for more details. More Information on autoscaling parameters can be found here and for liveness probe here. Outputs Output Description service_scoring_uri Scoring URI of the webservice that was created (only provided if delete_service_after_test is set to False). service_swagger_uri Swagger Uri of the webservice that was created (only provided if delete_service_after_test is set to False). Environment variables Certain parameters are considered secrets and should therefore be passed as environment variables from your secrets, if you want to use custom values. Environment variable Required Allowed Values Default Description CONTAINER_REGISTRY_ADRESS   str null The DNS name or IP address of the Azure Container Registry (ACR). Required, if you specified a custom_base_image that is only available in your ACR. CONTAINER_REGISTRY_USERNAME   str null The username for ACR. Required, if you specified a custom_base_image that is only available in your ACR. CONTAINER_REGISTRY_PASSWORD   str null The password for ACR. Required, if you specified a custom_base_image that is only available in your ACR. PRIMARY_KEY   str null A primary auth key to use for this Webservice. If not specified, Azure will automatically assign a key. SECONDARY_KEY   str null A secondary auth key to use for this Webservice. If not specified, Azure will automatically assign a key. CMK_VAULT_BASE_URL   str null Customer managed Key Vault base url. This value is ACI specific. CMK_KEY_NAME   str null Customer managed key name. This value is ACI specific. CMK_KEY_VERSION   str null Customer managed key version. This value is ACI specific. Other Azure Machine Learning Actions aml-workspace - Connects to or creates a new workspace aml-compute - Connects to or creates a new compute target in Azure Machine Learning aml-run - Submits a ScriptRun, an Estimator or a Pipeline to Azure Machine Learning aml-registermodel - Registers a model to Azure Machine Learning aml-deploy - Deploys a model and creates an endpoint for the model Contributing This project welcomes contributions and suggestions. Most contributions require you to agree to a Contributor License Agreement (CLA) declaring that you have the right to, and actually do, grant us the rights to use your contribution. For details, visit https://cla.opensource.microsoft.com. When you submit a pull request, a CLA bot will automatically determine whether you need to provide a CLA and decorate the PR appropriately (e.g., status check, comment). Simply follow the instructions provided by the bot. You will only need to do this once across all repos using our CLA. This project has adopted the Microsoft Open Source Code of Conduct. For more information see the Code of Conduct FAQ or contact opencode@microsoft.com with any additional questions or comments.","@type":"BlogPosting","url":"https://machine-learning-apps.github.io/MLDevOps/docs/aml-deploy.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://machine-learning-apps.github.io/MLDevOps/docs/aml-deploy.html"},"headline":"Aml Deploy","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body class="document /docs/aml-deploy">

<div class="topnav">
    <a href="/">MLOps</a>
    <a href="//actions">Actions</a>
    <a href="//templates">Templates</a>
    <a href="//docs">Docs</a>
    <a href="https://github.com/machine-learning-apps/MLOps" class="help-link">MLOps Repository</a>
  </div>

<section id="hero-spot" class="hero-spot">
    <a href="/"><img src="/images/ml_apps.png" alt="ML Ops" class="logo" /></a>

<h1 class="title">Aml Deploy</h1>

</section>

<section class="content">

<h2 id="usage">Usage</h2>

<p>The Azure Machine Learning Deploy action will deploy your model on Azure Machine Learning and create a real-time endpoint for use in other systems. The action currently supports Azure Container Instance and Azure Kubernetes Service as compute target and also supports the no-code deployment of Azure Machine Learning, if the model has been regiustered accordingly.</p>

<p>This GitHub Action also allows you to provide a python script that executes tests against the  Webservice endpoint after the model deplyoment has completed successfully. You can enable tests by setting the parameter <code class="language-plaintext highlighter-rouge">test_enabled</code> to true. In addition to that, you have to provide a python script (default <code class="language-plaintext highlighter-rouge">code/test/test.py</code>) which includes a function (default ` def main(webservice):`) that describes your tests that you want to execute against the service object. The python script gets the <a href="https://docs.microsoft.com/en-us/python/api/azureml-core/azureml.core.webservice(class)?view=azure-ml-py">webservice object</a> injected. The action fails, if the test script fails.</p>

<p>This action requires an Azure Machine Learning workspace to be created or attached to via the <a href="https://github.com/Azure/aml-workspace">aml-workspace</a> action and an AKS cluster if you are planning to deploy your model to such a compute target. AKS clsuters can be managed via the <a href="https://github.com/Azure/aml-compute">aml-compute</a> action.</p>

<h2 id="template-repositories">Template repositories</h2>

<p>This action is one in a series of actions that can be used to setup an ML Ops process. Examples of these can be found at</p>
<ol>
  <li>Simple example: <a href="https://github.com/machine-learning-apps/ml-template-azure">ml-template-azure</a> and</li>
  <li>Comprehensive example: <a href="https://github.com/Azure/aml-template">aml-template</a>.</li>
</ol>

<h3 id="example-workflow">Example workflow</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">My Workflow</span>
<span class="na">on</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">push</span><span class="pi">,</span> <span class="nv">pull_request</span><span class="pi">]</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>
    <span class="c1"># Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Check Out Repository</span>
      <span class="na">id</span><span class="pi">:</span> <span class="s">checkout_repository</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>

    <span class="c1"># AML Workspace Action</span>
    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">Azure/aml-workspace</span>
      <span class="na">id</span><span class="pi">:</span> <span class="s">aml_workspace</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">azure_credentials</span><span class="pi">:</span> <span class="s">$</span>
    
    <span class="c1"># AML Register Model Action</span>
    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">Azure/aml-registermodel</span>
      <span class="na">id</span><span class="pi">:</span> <span class="s">aml_registermodel</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">azure_credentials</span><span class="pi">:</span> <span class="s">$</span>
        <span class="na">run_id</span><span class="pi">:</span>  <span class="s2">"</span><span class="s">&lt;your-run-id&gt;"</span>
        <span class="na">experiment_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">&lt;your-experiment-name&gt;"</span>
    
    <span class="c1"># Deploy model in Azure Machine Learning to ACI</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Deploy model</span>
      <span class="na">id</span><span class="pi">:</span> <span class="s">aml_deploy</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">Azure/aml-deploy@master</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="c1"># required inputs</span>
        <span class="na">azure_credentials</span><span class="pi">:</span> <span class="s">$</span>
        <span class="na">model_name</span><span class="pi">:</span>  <span class="s">$</span>
        <span class="na">model_version</span><span class="pi">:</span> <span class="s">$</span>
        <span class="c1"># optional inputs</span>
        <span class="na">parameters_file</span><span class="pi">:</span> <span class="s2">"</span><span class="s">deploy.json"</span>
</code></pre></div></div>

<h3 id="inputs">Inputs</h3>

<table>
  <thead>
    <tr>
      <th>Input</th>
      <th>Required</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>azure_credentials</td>
      <td>x</td>
      <td>-</td>
      <td>Output of <code class="language-plaintext highlighter-rouge">az ad sp create-for-rbac --name &lt;your-sp-name&gt; --role contributor --scopes /subscriptions/&lt;your-subscriptionId&gt;/resourceGroups/&lt;your-rg&gt; --sdk-auth</code>. This should be stored in your secrets</td>
    </tr>
    <tr>
      <td>model_name</td>
      <td>x</td>
      <td>-</td>
      <td>Name of the model that will be deployed.</td>
    </tr>
    <tr>
      <td>model_version</td>
      <td>x</td>
      <td>-</td>
      <td>Version of the model that will be deployed.</td>
    </tr>
    <tr>
      <td>parameters_file</td>
      <td> </td>
      <td><code class="language-plaintext highlighter-rouge">"registermodel.json"</code></td>
      <td>JSON file in the <code class="language-plaintext highlighter-rouge">.cloud/.azure</code> folder specifying your Azure Machine Learning model registration details.</td>
    </tr>
  </tbody>
</table>

<h4 id="azure-credentials">Azure Credentials</h4>

<p>Azure credentials are required to connect to your Azure Machine Learning Workspace. These may have been created for an action you are already using in your repository, if so, you can skip the steps below.</p>

<p>Install the <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Azure CLI</a> on your computer or use the Cloud CLI and execute the following command to generate the required credentials:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Replace {service-principal-name}, {subscription-id} and {resource-group} with your Azure subscription id and resource group name and any name for your service principle</span>
az ad sp create-for-rbac <span class="nt">--name</span> <span class="o">{</span>service-principal-name<span class="o">}</span> <span class="se">\</span>
                         <span class="nt">--role</span> contributor <span class="se">\</span>
                         <span class="nt">--scopes</span> /subscriptions/<span class="o">{</span>subscription-id<span class="o">}</span>/resourceGroups/<span class="o">{</span>resource-group<span class="o">}</span> <span class="se">\</span>
                         <span class="nt">--sdk-auth</span>
</code></pre></div></div>

<p>This will generate the following JSON output:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span>
  <span class="s2">"clientId"</span>: <span class="s2">"&lt;GUID&gt;"</span>,
  <span class="s2">"clientSecret"</span>: <span class="s2">"&lt;GUID&gt;"</span>,
  <span class="s2">"subscriptionId"</span>: <span class="s2">"&lt;GUID&gt;"</span>,
  <span class="s2">"tenantId"</span>: <span class="s2">"&lt;GUID&gt;"</span>,
  <span class="o">(</span>...<span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Add this JSON output as <a href="https://help.github.com/en/actions/configuring-and-managing-workflows/creating-and-storing-encrypted-secrets#creating-encrypted-secrets">a secret</a> with the name <code class="language-plaintext highlighter-rouge">AZURE_CREDENTIALS</code> in your GitHub repository.</p>

<h4 id="parameters-file">Parameters File</h4>

<p>The action tries to load a JSON file in the <code class="language-plaintext highlighter-rouge">.cloud/.azure</code> folder in your repository, which specifies details for the model deployment to your Azure Machine Learning Workspace. By default, the action expects a file with the name <code class="language-plaintext highlighter-rouge">deploy.json</code>. If your JSON file has a different name, you can specify it with this parameter. Note that none of these values are required and in the absence, defaults will be created with a combination of the repo name and branch name.</p>

<p>A sample file can be found in this repository in the folder <code class="language-plaintext highlighter-rouge">.cloud/.azure</code>. There are separate parameters that are used for the ACI deployment, the AKS deployment and some that are common for both deployment options.</p>

<h5 id="common-parameters">Common parameters</h5>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Required</th>
      <th>Allowed Values</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>name</td>
      <td> </td>
      <td>str</td>
      <td><REPOSITORY_NAME>-<BRANCH_NAME></BRANCH_NAME></REPOSITORY_NAME></td>
      <td>The name to give the deployed service. Must be unique to the workspace, only consist of lowercase letters, numbers, or dashes, start with a letter, and be between 3 and 32 characters long.</td>
    </tr>
    <tr>
      <td>deployment_compute_target</td>
      <td>(for AKS deployment)</td>
      <td>str</td>
      <td>null</td>
      <td>Name of the compute target to deploy the webservice to. As Azure Container Instances has no associated ComputeTarget, leave this parameter as null to deploy to Azure Container Instances.</td>
    </tr>
    <tr>
      <td>inference_source_directory</td>
      <td> </td>
      <td>str</td>
      <td><code class="language-plaintext highlighter-rouge">"code/deploy/"</code></td>
      <td>The path to the folder that contains all files to create the image.</td>
    </tr>
    <tr>
      <td>inference_entry_script</td>
      <td> </td>
      <td>str</td>
      <td><code class="language-plaintext highlighter-rouge">"score.py"</code></td>
      <td>The path to a local file in your repository that contains the code to run for the image and score the data. This path is relative to the specified source directory. The python script has to define an <code class="language-plaintext highlighter-rouge">init</code> and a <code class="language-plaintext highlighter-rouge">run</code> function. A sample can be found in the template repositories.</td>
    </tr>
    <tr>
      <td>conda_file</td>
      <td> </td>
      <td>str</td>
      <td><code class="language-plaintext highlighter-rouge">"environment.yml"</code></td>
      <td>The path to a local file in your repository containing a conda environment definition to use for the image. This path is relative to the specified source directory.</td>
    </tr>
    <tr>
      <td>extra_docker_file_steps</td>
      <td> </td>
      <td>str</td>
      <td>null</td>
      <td>The path to a local file in your repository containing additional Docker steps to run when setting up image. This path is relative to the specified source directory.</td>
    </tr>
    <tr>
      <td>enable_gpu</td>
      <td> </td>
      <td>str</td>
      <td>false</td>
      <td>Indicates whether to enable GPU support in the image. The GPU image must be used on Microsoft Azure Services such as Azure Container Instances, Azure Machine Learning Compute, Azure Virtual Machines, and Azure Kubernetes Service.</td>
    </tr>
    <tr>
      <td>cuda_version</td>
      <td> </td>
      <td>str</td>
      <td><code class="language-plaintext highlighter-rouge">"9.1"</code> if <code class="language-plaintext highlighter-rouge">enable_gpu</code> is set to true</td>
      <td>The Version of CUDA to install for images that need GPU support. The GPU image must be used on Microsoft Azure Services such as Azure Container Instances, Azure Machine Learning Compute, Azure Virtual Machines, and Azure Kubernetes Service. Supported versions are 9.0, 9.1, and 10.0.</td>
    </tr>
    <tr>
      <td>runtime</td>
      <td> </td>
      <td>str: <code class="language-plaintext highlighter-rouge">"python"</code> or <code class="language-plaintext highlighter-rouge">"spark-py"</code></td>
      <td><code class="language-plaintext highlighter-rouge">"python"</code></td>
      <td>The runtime to use for the image.</td>
    </tr>
    <tr>
      <td>custom_base_image</td>
      <td> </td>
      <td>str</td>
      <td>null</td>
      <td>A custom Docker image to be used as base image. If no base image is given then the base image will be used based off of given runtime parameter.</td>
    </tr>
    <tr>
      <td>model_data_collection_enabled</td>
      <td> </td>
      <td>bool</td>
      <td>false</td>
      <td>Whether or not to enable model data collection for this Webservice.</td>
    </tr>
    <tr>
      <td>authentication_enabled</td>
      <td> </td>
      <td>bool</td>
      <td>false for ACI, true for AKS</td>
      <td>Whether or not to enable key auth for this Webservice.</td>
    </tr>
    <tr>
      <td>app_insights_enabled</td>
      <td> </td>
      <td>bool</td>
      <td>false</td>
      <td>Whether or not to enable Application Insights logging for this Webservice.</td>
    </tr>
    <tr>
      <td>cpu_cores</td>
      <td> </td>
      <td>float</td>
      <td>0.1</td>
      <td>The number of CPU cores to allocate for this Webservice. Can be a decimal.</td>
    </tr>
    <tr>
      <td>memory_gb</td>
      <td> </td>
      <td>float</td>
      <td>0.5</td>
      <td>The amount of memory (in GB) to allocate for this Webservice. Can be a decimal.</td>
    </tr>
    <tr>
      <td>delete_service_after_deployment</td>
      <td> </td>
      <td>bool</td>
      <td>false</td>
      <td>Indicates whether the service gets deleted after the deployment completed successfully.</td>
    </tr>
    <tr>
      <td>tags</td>
      <td> </td>
      <td>dict: {“<your-run-tag-key>": "<your-run-tag-value>", ...}</your-run-tag-value></your-run-tag-key></td>
      <td>null</td>
      <td>Dictionary of key value tags to give this Webservice.</td>
    </tr>
    <tr>
      <td>properties</td>
      <td> </td>
      <td>dict: {“<your-run-tag-key>": "<your-run-tag-value>", ...}</your-run-tag-value></your-run-tag-key></td>
      <td> </td>
      <td>Dictionary of key value properties to give this Webservice. These properties cannot be changed after deployment, however new key value pairs can be added.</td>
    </tr>
    <tr>
      <td>description</td>
      <td> </td>
      <td>str</td>
      <td>null</td>
      <td>A description to give this Webservice and image.</td>
    </tr>
    <tr>
      <td>test_enabled</td>
      <td> </td>
      <td>bool</td>
      <td>false</td>
      <td>Whether to run tests for this model deployment and the created real-time endpoint.</td>
    </tr>
    <tr>
      <td>test_file_path</td>
      <td> </td>
      <td>str</td>
      <td><code class="language-plaintext highlighter-rouge">"code/test/test.py"</code></td>
      <td>Path to the python script in your repository in which you define your own tests that you want to run against the webservice endpoint. The GitHub Action fails, if your script fails.</td>
    </tr>
    <tr>
      <td>test_file_function_name</td>
      <td> </td>
      <td>str</td>
      <td><code class="language-plaintext highlighter-rouge">"main"</code></td>
      <td>Name of the function in your python script in your repository in which you define your own tests that you want to run against the webservice endpoint. The function gets the webservice object injected and allows you to run tests against the scoring uri. The GitHub Action fails, if your script fails.</td>
    </tr>
  </tbody>
</table>

<p>Please visit <a href="https://docs.microsoft.com/en-us/python/api/azureml-core/azureml.core.model.inferenceconfig?view=azure-ml-py">this website</a> and <a href="https://docs.microsoft.com/en-us/python/api/azureml-core/azureml.core.model(class)?view=azure-ml-py#deploy-workspace--name--models--inference-config-none--deployment-config-none--deployment-target-none--overwrite-false-">this website</a> for more details.</p>

<h5 id="aci-specific-parameters">ACI specific parameters</h5>

<p>ACI is the default deployment resource. A sample file for an aci deployment can be found in the <code class="language-plaintext highlighter-rouge">.cloud/.azure</code> folder.</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Required</th>
      <th>Allowed Values</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>location</td>
      <td> </td>
      <td>str: <a href="https://azure.microsoft.com/en-us/global-infrastructure/services/?products=container-instances">supported region</a></td>
      <td>workspace location</td>
      <td>The Azure region to deploy this Webservice to.</td>
    </tr>
    <tr>
      <td>ssl_enabled</td>
      <td> </td>
      <td>bool</td>
      <td>false</td>
      <td>Whether or not to enable SSL for this Webservice.</td>
    </tr>
    <tr>
      <td>ssl_cert_pem_file</td>
      <td> </td>
      <td>str</td>
      <td>null</td>
      <td>A file path to a file containing cert information for SSL validation. Must provide all three CName, cert file, and key file to enable SSL validation.</td>
    </tr>
    <tr>
      <td>ssl_key_pem_file</td>
      <td> </td>
      <td>st</td>
      <td>null</td>
      <td>A file path to a file containing key information for SSL validation. Must provide all three CName, cert file, and key file to enable SSL validation.</td>
    </tr>
    <tr>
      <td>ssl_cname</td>
      <td> </td>
      <td>str</td>
      <td>null</td>
      <td>A CName to use if enabling SSL validation on the cluster. Must provide all three CName, cert file, and key file to enable SSL validation.</td>
    </tr>
    <tr>
      <td>dns_name_label</td>
      <td> </td>
      <td>str</td>
      <td>null</td>
      <td>The DNS name label for the scoring endpoint. If not specified a unique DNS name label will be generated for the scoring endpoint.</td>
    </tr>
  </tbody>
</table>

<p>Please visit <a href="https://docs.microsoft.com/en-us/python/api/azureml-core/azureml.core.webservice.aciwebservice?view=azure-ml-py#deploy-configuration-cpu-cores-none--memory-gb-none--tags-none--properties-none--description-none--location-none--auth-enabled-none--ssl-enabled-none--enable-app-insights-none--ssl-cert-pem-file-none--ssl-key-pem-file-none--ssl-cname-none--dns-name-label-none--primary-key-none--secondary-key-none--collect-model-data-none--cmk-vault-base-url-none--cmk-key-name-none--cmk-key-version-none-">this website</a> for more details.</p>

<h5 id="aks-deployment">AKS Deployment</h5>

<p>For the deployment of the model to AKS, you must configure an AKS resource and specify the name of the AKS cluster with the <code class="language-plaintext highlighter-rouge">deployment_compute_target</code> parameter. Additional parameters allow you to finetune your deployment on AKS with options like autoscaling and the liveness probe requirements. These will be set to default parameters if not provided.</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Required</th>
      <th>Allowed Values</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>gpu_cores</td>
      <td> </td>
      <td>float</td>
      <td>1</td>
      <td>The number of GPU cores to allocate for this Webservice.</td>
    </tr>
    <tr>
      <td>autoscale_enabled</td>
      <td> </td>
      <td>bool</td>
      <td>true if <code class="language-plaintext highlighter-rouge">num_replicas</code> is null</td>
      <td>Whether or not to enable autoscaling for this Webservice.</td>
    </tr>
    <tr>
      <td>autoscale_min_replicas</td>
      <td> </td>
      <td>int</td>
      <td>1</td>
      <td>The minimum number of containers to use when autoscaling this Webservice.</td>
    </tr>
    <tr>
      <td>autoscale_max_replicas</td>
      <td> </td>
      <td>int</td>
      <td>10</td>
      <td>The maximum number of containers to use when autoscaling this Webservice.</td>
    </tr>
    <tr>
      <td>autoscale_refresh_seconds</td>
      <td> </td>
      <td>int</td>
      <td>1</td>
      <td>How often the autoscaler should attempt to scale this Webservice.</td>
    </tr>
    <tr>
      <td>autoscale_target_utilization</td>
      <td> </td>
      <td>int</td>
      <td>70</td>
      <td>The target utilization (in percent out of 100) the autoscaler should attempt to maintain for this Webservice.</td>
    </tr>
    <tr>
      <td>scoring_timeout_ms</td>
      <td> </td>
      <td>int</td>
      <td>60000</td>
      <td>A timeout in ms to enforce for scoring calls to this Webservice.</td>
    </tr>
    <tr>
      <td>replica_max_concurrent_requests</td>
      <td> </td>
      <td>float</td>
      <td>1</td>
      <td>The number of maximum concurrent requests per replica to allow for this Webservice. <strong>Do not change this setting from the default value of 1 unless instructed by Microsoft Technical Support or a member of Azure Machine Learning team.</strong></td>
    </tr>
    <tr>
      <td>max_request_wait_time</td>
      <td> </td>
      <td>int</td>
      <td>500</td>
      <td>The maximum amount of time a request will stay in the queue (in milliseconds) before returning a 503 error.</td>
    </tr>
    <tr>
      <td>num_replicas</td>
      <td> </td>
      <td>int</td>
      <td>null</td>
      <td>The number of containers to allocate for this Webservice. <strong>No default, if this parameter is not set then the autoscaler is enabled by default.</strong></td>
    </tr>
    <tr>
      <td>period_seconds</td>
      <td> </td>
      <td>int: [1, inf[</td>
      <td>10</td>
      <td>How often (in seconds) to perform the liveness probe.</td>
    </tr>
    <tr>
      <td>initial_delay_seconds</td>
      <td> </td>
      <td>int</td>
      <td>310</td>
      <td>The number of seconds after the container has started before liveness probes are initiated.</td>
    </tr>
    <tr>
      <td>timeout_seconds</td>
      <td> </td>
      <td>int: [1, inf[</td>
      <td>1</td>
      <td>The number of seconds after which the liveness probe times out.</td>
    </tr>
    <tr>
      <td>success_threshold</td>
      <td> </td>
      <td>int: [1, inf[</td>
      <td>1</td>
      <td>The minimum consecutive successes for the liveness probe to be considered successful after having failed.</td>
    </tr>
    <tr>
      <td>failure_threshold</td>
      <td> </td>
      <td>int: [1, inf[</td>
      <td>3</td>
      <td>When a Pod starts and the liveness probe fails, Kubernetes will try failureThreshold times before giving up.</td>
    </tr>
    <tr>
      <td>namespace</td>
      <td> </td>
      <td>str</td>
      <td>null</td>
      <td>The Kubernetes namespace in which to deploy this Webservice: up to 63 lowercase alphanumeric (‘a’-‘z’, ‘0’-‘9’) and hyphen (‘-‘) characters. The first and last characters cannot be hyphens.</td>
    </tr>
    <tr>
      <td>token_auth_enabled</td>
      <td> </td>
      <td>bool</td>
      <td>false</td>
      <td>Whether or not to enable Token auth for this Webservice. If this is enabled, users can access this Webservice by fetching an access token using their Azure Active Directory credentials.</td>
    </tr>
  </tbody>
</table>

<p>Please visit <a href="https://docs.microsoft.com/en-us/python/api/azureml-core/azureml.core.webservice.aks.akswebservice?view=azure-ml-py#deploy-configuration-autoscale-enabled-none--autoscale-min-replicas-none--autoscale-max-replicas-none--autoscale-refresh-seconds-none--autoscale-target-utilization-none--collect-model-data-none--auth-enabled-none--cpu-cores-none--memory-gb-none--enable-app-insights-none--scoring-timeout-ms-none--replica-max-concurrent-requests-none--max-request-wait-time-none--num-replicas-none--primary-key-none--secondary-key-none--tags-none--properties-none--description-none--gpu-cores-none--period-seconds-none--initial-delay-seconds-none--timeout-seconds-none--success-threshold-none--failure-threshold-none--namespace-none--token-auth-enabled-none--compute-target-name-none-">this website</a> for more details. More Information on autoscaling parameters can be found <a href="https://docs.microsoft.com/en-us/python/api/azureml-core/azureml.core.webservice.aks.autoscaler?view=azure-ml-py">here</a> and for liveness probe <a href="https://docs.microsoft.com/en-us/python/api/azureml-core/azureml.core.webservice.aks.livenessproberequirements?view=azure-ml-py">here</a>.</p>

<h3 id="outputs">Outputs</h3>

<table>
  <thead>
    <tr>
      <th>Output</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>service_scoring_uri</td>
      <td>Scoring URI of the webservice that was created (only provided if delete_service_after_test is set to False).</td>
    </tr>
    <tr>
      <td>service_swagger_uri</td>
      <td>Swagger Uri of the webservice that was created (only provided if delete_service_after_test is set to False).</td>
    </tr>
  </tbody>
</table>

<h3 id="environment-variables">Environment variables</h3>

<p>Certain parameters are considered secrets and should therefore be passed as environment variables from your secrets, if you want to use custom values.</p>

<table>
  <thead>
    <tr>
      <th>Environment variable</th>
      <th>Required</th>
      <th>Allowed Values</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>CONTAINER_REGISTRY_ADRESS</td>
      <td> </td>
      <td>str</td>
      <td>null</td>
      <td>The DNS name or IP address of the Azure Container Registry (ACR). Required, if you specified a <code class="language-plaintext highlighter-rouge">custom_base_image</code> that is only available in your ACR.</td>
    </tr>
    <tr>
      <td>CONTAINER_REGISTRY_USERNAME</td>
      <td> </td>
      <td>str</td>
      <td>null</td>
      <td>The username for ACR. Required, if you specified a <code class="language-plaintext highlighter-rouge">custom_base_image</code> that is only available in your ACR.</td>
    </tr>
    <tr>
      <td>CONTAINER_REGISTRY_PASSWORD</td>
      <td> </td>
      <td>str</td>
      <td>null</td>
      <td>The password for ACR. Required, if you specified a <code class="language-plaintext highlighter-rouge">custom_base_image</code> that is only available in your ACR.</td>
    </tr>
    <tr>
      <td>PRIMARY_KEY</td>
      <td> </td>
      <td>str</td>
      <td>null</td>
      <td>A primary auth key to use for this Webservice. If not specified, Azure will automatically assign a key.</td>
    </tr>
    <tr>
      <td>SECONDARY_KEY</td>
      <td> </td>
      <td>str</td>
      <td>null</td>
      <td>A secondary auth key to use for this Webservice. If not specified, Azure will automatically assign a key.</td>
    </tr>
    <tr>
      <td>CMK_VAULT_BASE_URL</td>
      <td> </td>
      <td>str</td>
      <td>null</td>
      <td>Customer managed Key Vault base url. This value is ACI specific.</td>
    </tr>
    <tr>
      <td>CMK_KEY_NAME</td>
      <td> </td>
      <td>str</td>
      <td>null</td>
      <td>Customer managed key name.  This value is ACI specific.</td>
    </tr>
    <tr>
      <td>CMK_KEY_VERSION</td>
      <td> </td>
      <td>str</td>
      <td>null</td>
      <td>Customer managed key version.  This value is ACI specific.</td>
    </tr>
  </tbody>
</table>

<h3 id="other-azure-machine-learning-actions">Other Azure Machine Learning Actions</h3>

<ul>
  <li><a href="https://github.com/Azure/aml-workspace">aml-workspace</a> - Connects to or creates a new workspace</li>
  <li><a href="https://github.com/Azure/aml-compute">aml-compute</a> - Connects to or creates a new compute target in Azure Machine Learning</li>
  <li><a href="https://github.com/Azure/aml-run">aml-run</a> - Submits a ScriptRun, an Estimator or a Pipeline to Azure Machine Learning</li>
  <li><a href="https://github.com/Azure/aml-registermodel">aml-registermodel</a> - Registers a model to Azure Machine Learning</li>
  <li><a href="https://github.com/Azure/aml-deploy">aml-deploy</a> - Deploys a model and creates an endpoint for the model</li>
</ul>

<h1 id="contributing">Contributing</h1>

<p>This project welcomes contributions and suggestions.  Most contributions require you to agree to a
Contributor License Agreement (CLA) declaring that you have the right to, and actually do, grant us
the rights to use your contribution. For details, visit https://cla.opensource.microsoft.com.</p>

<p>When you submit a pull request, a CLA bot will automatically determine whether you need to provide
a CLA and decorate the PR appropriately (e.g., status check, comment). Simply follow the instructions
provided by the bot. You will only need to do this once across all repos using our CLA.</p>

<p>This project has adopted the <a href="https://opensource.microsoft.com/codeofconduct/">Microsoft Open Source Code of Conduct</a>.
For more information see the <a href="https://opensource.microsoft.com/codeofconduct/faq/">Code of Conduct FAQ</a> or
contact <a href="mailto:opencode@microsoft.com">opencode@microsoft.com</a> with any additional questions or comments.</p>



</section>

<footer class="page-footer">
  <ul class="site-footer-links right">
    <li><a href="https://status.github.com/">Status</a></li>
    <li><a href="https://developer.github.com">API</a></li>
    <li><a href="https://training.github.com">Training</a></li>
    <li><a href="https://shop.github.com">Shop</a></li>
    <li><a href="https://github.com/blog">Blog</a></li>
    <li><a href="https://github.com/about">About</a></li>
  </ul>

  <a href="/">
    <span class="mega-octicon octicon-mark-github"></span>
  </a>

  <ul class="site-footer-links">
    <li>&copy; 2020 <span>GitHub</span>, Inc.</li>
    <li><a href="https://github.com/site/terms">Terms</a></li>
    <li><a href="https://github.com/site/privacy">Privacy</a></li>
    <li><a href="https://github.com/security">Security</a></li>
    <li><a href="https://github.com/contact">Contact</a></li>
  </ul>
</footer>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-3769691-40', 'github.com');
  ga('send', 'pageview');
</script>

</body>
</html>


